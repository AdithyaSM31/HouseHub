# MongoDB Atlas Setup Guide

This guide will help you set up MongoDB Atlas (free tier) for your HouseHub deployment.

## 1. Create MongoDB Atlas Account

1. Go to [https://www.mongodb.com/cloud/atlas/register](https://www.mongodb.com/cloud/atlas/register)
2. Sign up with email or Google account
3. Complete email verification

## 2. Create a New Cluster

1. Click **"Build a Database"**
2. Choose **"M0 FREE"** tier
   - 512 MB storage (sufficient for this app)
   - Shared RAM
   - No credit card required
3. Select **Cloud Provider & Region**:
   - Provider: AWS (recommended)
   - Region: Choose closest to your users (e.g., Mumbai for India)
4. **Cluster Name**: `HouseHub` or any name you prefer
5. Click **"Create Cluster"**
6. Wait 3-5 minutes for cluster creation

## 3. Create Database User

1. Go to **Database Access** (left sidebar)
2. Click **"Add New Database User"**
3. Authentication Method: **Password**
   - Username: `househub_admin`
   - Password: Click **"Autogenerate Secure Password"** and **SAVE IT**
4. Database User Privileges: **"Read and write to any database"**
5. Click **"Add User"**

## 4. Configure Network Access

1. Go to **Network Access** (left sidebar)
2. Click **"Add IP Address"**
3. Select **"Allow Access from Anywhere"** (0.0.0.0/0)
   - This is needed for Render to connect
   - In production, you can restrict to Render's IP ranges
4. Click **"Confirm"**

## 5. Get Connection String

1. Go to **Database** (left sidebar)
2. Click **"Connect"** on your cluster
3. Choose **"Connect your application"**
4. Driver: **Node.js**, Version: **5.5 or later**
5. Copy the connection string, it looks like:
   ```
   mongodb+srv://househub_admin:<password>@househub.xxxxx.mongodb.net/?retryWrites=true&w=majority
   ```
6. **Replace `<password>`** with your actual password from step 3
7. **Add database name** before the `?`:
   ```
   mongodb+srv://househub_admin:YOUR_PASSWORD@househub.xxxxx.mongodb.net/househub?retryWrites=true&w=majority
   ```

## 6. Update Environment Variables

### Local Development (.env)
```env
MONGODB_URI=mongodb+srv://househub_admin:YOUR_PASSWORD@househub.xxxxx.mongodb.net/househub?retryWrites=true&w=majority
```

### Render Dashboard
1. Go to your service ‚Üí **Environment**
2. Add new variable:
   - **Key**: `MONGODB_URI`
   - **Value**: Your full connection string (from step 5)
3. Click **"Save Changes"**
4. Service will auto-restart

## 7. Seed Database

### Option A: Run Locally
```bash
cd backend
npm run seed
```

### Option B: Run on Render (Manual Deploy)
1. In Render dashboard ‚Üí **Manual Deploy**
2. Add build command temporarily:
   ```
   npm install && node scripts/seedMongoDB.js
   ```
3. After seeding, change back to: `npm install`

### Option C: Use MongoDB Compass
1. Download [MongoDB Compass](https://www.mongodb.com/try/download/compass)
2. Connect using connection string
3. Create database: `househub`
4. Create collections: `users`, `properties`, `bookmarks`, `conversations`, `messages`
5. Use seed script or import JSON manually

## 8. Verify Connection

### Test Locally
```bash
cd backend
npm start
```

Look for:
```
‚úÖ MongoDB Connected: househub-shard-00-00.xxxxx.mongodb.net
üìÅ Database: househub
```

### Test on Render
1. Go to **Logs** tab
2. Look for successful MongoDB connection message
3. Check for any errors

## 9. MongoDB Atlas Dashboard Features

### Database ‚Üí Browse Collections
- View all your data
- Manually add/edit/delete documents
- Run queries

### Monitoring ‚Üí Metrics
- Connection count
- Operations per second
- Network traffic
- Disk usage

### Monitoring ‚Üí Alerts
- Set up email alerts for:
  - High connection count
  - Storage reaching limit
  - Performance issues

## 10. Common Issues & Fixes

### Issue: "Authentication failed"
**Fix**: 
- Double-check username and password
- Ensure password doesn't have special characters (or URL-encode them)
- Verify user has correct permissions

### Issue: "Network timeout"
**Fix**:
- Check Network Access whitelist includes 0.0.0.0/0
- Verify connection string is correct
- Check your internet connection

### Issue: "Database not found"
**Fix**:
- Ensure database name is in connection string: `/househub?`
- Database is auto-created on first write

### Issue: "Storage full"
**Fix**:
- Free tier has 512 MB limit
- Delete old test data
- Upgrade to paid tier if needed

## 11. Security Best Practices

1. **Strong Password**: Use autogenerated password, never simple passwords
2. **IP Whitelist**: In production, restrict to Render's IP ranges
3. **Separate Users**: Create different users for dev/prod
4. **Regular Backups**: 
   - Atlas provides daily backups (paid feature)
   - Or use `mongodump` locally
5. **Monitor Access**: Check Atlas Activity Feed regularly

## 12. MongoDB Atlas Free Tier Limits

- **Storage**: 512 MB
- **RAM**: Shared
- **Backups**: None (manual only)
- **Connections**: Unlimited
- **Data Transfer**: Unlimited
- **Uptime**: No SLA

For production with heavy usage, consider upgrading to M2 ($9/month) or higher.

## 13. Connection String Examples

### Development (Local MongoDB)
```
mongodb://localhost:27017/househub
```

### Production (MongoDB Atlas)
```
mongodb+srv://username:password@cluster.xxxxx.mongodb.net/househub?retryWrites=true&w=majority
```

### With Additional Options
```
mongodb+srv://username:password@cluster.xxxxx.mongodb.net/househub?retryWrites=true&w=majority&appName=HouseHub
```

## 14. Next Steps

After setup:

1. ‚úÖ Update `.env` with MONGODB_URI
2. ‚úÖ Update Render environment variables
3. ‚úÖ Run seed script to populate data
4. ‚úÖ Test login with: john@example.com / password123
5. ‚úÖ Verify properties are loading
6. ‚úÖ Test bookmarks and messages

## Support

- [MongoDB Atlas Documentation](https://www.mongodb.com/docs/atlas/)
- [MongoDB Node.js Driver Docs](https://www.mongodb.com/docs/drivers/node/)
- [Mongoose Documentation](https://mongoosejs.com/docs/)

---

**Your database is now persistent and will survive Render restarts! üéâ**
